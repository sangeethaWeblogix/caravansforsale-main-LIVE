name: Generate Cache (With Batching)

on:
  schedule:
    # Run daily at 2 AM UTC
    - cron: '0 2 * * *'

  workflow_dispatch:
    inputs:
      target:
        description: 'What to generate'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - priority
          - small-types
          - large-types
          - categories
          - states
          - regions
          - makes
          - models
          - price
          - atm
          - sleep
          - length
          - state-make
          - region-make
          - cat-state
          - cat-region

# ==========================================
# API TYPES & BATCH STRATEGY
#
# URLs fetched from:
#   https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap/{type}
#
# OPTIMISATIONS (v3):
#  1. HTTP 500/502/503 treated as immediate skip (no retries)
#  2. Delays: 100ms between variants, 300ms between URLs
#  3. Reduced BATCH_SIZE: 25 URLs for slow/deep-URL types (region-make, cat-region)
#  4. More parallel batches: region-make 8â†’16, cat-region 8â†’16
#  5. cat-state moved out of small-types into its own job with 120-min timeout
#  6. Timeout guide:
#       priority       â†’ 60  min (Puppeteer, 8 total variants)
#       small-types    â†’ 60  min (<50 URLs, fast pages)
#       regions        â†’ 90  min (~62 URLs, 2 batches of 50)
#       state-make     â†’ 90  min (2 batches of 50)
#       makes          â†’ 90  min (6 batches of 50, ~267 URLs)
#       models         â†’ 90  min (6 batches of 50)
#       cat-state      â†’ 120 min (48 URLs, single runner, can be slow)
#       region-make    â†’ 90  min (16 batches of 25 â€” was 8Ã—50, too slow)
#       cat-region     â†’ 90  min (16 batches of 25 â€” was 8Ã—50, too slow)
#
# BATCH SIZE GUIDE:
#   Fast pages  (<5s fetch):  50 URLs/batch â†’ ~10 min/batch
#   Medium pages (~10s fetch): 25 URLs/batch â†’ ~17 min/batch
#   Slow pages  (~26s fetch): 25 URLs/batch â†’ ~45 min/batch â† region-make observed
#
# CURRENT ESTIMATED URL COUNTS:
#   categories:  ~6    â†’ no batching
#   states:      ~8    â†’ no batching
#   regions:     ~62   â†’ 2 batches Ã— 50
#   makes:       ~267  â†’ 6 batches Ã— 50
#   models:      ~TBD  â†’ 6 batches Ã— 50 (adjust if needed)
#   price:       ~TBD  â†’ no batching
#   atm:         ~TBD  â†’ no batching
#   sleep:       ~TBD  â†’ no batching
#   length:      ~TBD  â†’ no batching
#   state-make:  ~TBD  â†’ 2 batches Ã— 50
#   region-make: ~TBD  â†’ 16 batches Ã— 25  â† CHANGED (was 8Ã—50)
#   cat-state:   ~48   â†’ own job, no batching
#   cat-region:  ~378  â†’ 16 batches Ã— 25  â† CHANGED (was 8Ã—50)
# ==========================================

jobs:

  # ==========================================
  # PRIORITY PAGES (Homepage + Listings) - WITH PUPPETEER
  # ==========================================
  generate-priority:
    runs-on: ubuntu-latest
    timeout-minutes: 60     # Puppeteer: 2 pages Ã— 4 variants = 8 total, generous
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'priority'))

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: |
          npm install node-fetch@2
          npm install puppeteer

      - name: ðŸŽ¯ Generate Priority Pages
        env:
          VERCEL_BASE_URL: ${{ secrets.VERCEL_BASE_URL }}
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_PAGE: 'all'
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-priority-pages.js

      - name: âœ… Complete
        if: success()
        run: echo "::notice::âœ… Priority pages generated successfully!"

  # ==========================================
  # SMALL TYPES (no batching, <50 URLs, fast pages)
  # categories, states, price, atm, sleep, length only
  # NOTE: cat-state moved to its own job (can be slow at 48 URLs)
  # ==========================================
  generate-small-types:
    runs-on: ubuntu-latest
    timeout-minutes: 60     # <50 URLs Ã— 4 variants Ã— ~5s = <20 min max
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'small-types'))

    strategy:
      matrix:
        type:
          - categories
          - states
          - price
          - atm
          - sleep
          - length
      fail-fast: false
      max-parallel: 6

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate ${{ matrix.type }}
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: ${{ matrix.type }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… ${{ matrix.type }} Complete
        if: success()
        run: echo "::notice::âœ… ${{ matrix.type }} completed!"

  # ==========================================
  # CAT-STATE (~48 URLs) - own job, no batching
  # Moved out of small-types: 48 URLs Ã— 4 variants can exceed 60 min
  # ==========================================
  generate-cat-state:
    runs-on: ubuntu-latest
    timeout-minutes: 120    # 48 URLs Ã— 4 variants Ã— ~26s worst case = ~83 min
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'small-types' || github.event.inputs.target == 'cat-state'))

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate cat-state
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: cat-state
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… cat-state Complete
        if: success()
        run: echo "::notice::âœ… cat-state completed!"

  # ==========================================
  # REGIONS (~62 URLs) - 2 batches Ã— 50
  # ==========================================
  generate-regions:
    runs-on: ubuntu-latest
    timeout-minutes: 90     # 50 URLs Ã— 4 variants Ã— ~10s = ~33 min, 90 is safe
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'small-types' || github.event.inputs.target == 'regions'))

    strategy:
      matrix:
        batch: [1, 2]
      fail-fast: false
      max-parallel: 2

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate regions (Batch ${{ matrix.batch }}/2)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: regions
          BATCH_SIZE: 50
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… regions Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… regions batch ${{ matrix.batch }} completed!"

  # ==========================================
  # STATE-MAKE (~TBD URLs) - 2 batches Ã— 50
  # ==========================================
  generate-state-make:
    runs-on: ubuntu-latest
    timeout-minutes: 90
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'large-types' || github.event.inputs.target == 'state-make'))

    strategy:
      matrix:
        batch: [1, 2]
      fail-fast: false
      max-parallel: 2

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate state-make (Batch ${{ matrix.batch }}/2)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: state-make
          BATCH_SIZE: 50
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… state-make Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… state-make batch ${{ matrix.batch }} completed!"

  # ==========================================
  # MAKES (~267 URLs) - 6 batches Ã— 50
  # ==========================================
  generate-makes:
    runs-on: ubuntu-latest
    timeout-minutes: 90
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'large-types' || github.event.inputs.target == 'makes'))

    strategy:
      matrix:
        batch: [1, 2, 3, 4, 5, 6]
      fail-fast: false
      max-parallel: 6

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate makes (Batch ${{ matrix.batch }}/6)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: makes
          BATCH_SIZE: 50
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… makes Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… makes batch ${{ matrix.batch }} completed!"

  # ==========================================
  # MODELS (~TBD URLs) - 6 batches Ã— 50
  # ==========================================
  generate-models:
    runs-on: ubuntu-latest
    timeout-minutes: 90
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'large-types' || github.event.inputs.target == 'models'))

    strategy:
      matrix:
        batch: [1, 2, 3, 4, 5, 6]
      fail-fast: false
      max-parallel: 6

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate models (Batch ${{ matrix.batch }}/6)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: models
          BATCH_SIZE: 50
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… models Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… models batch ${{ matrix.batch }} completed!"

  # ==========================================
  # REGION-MAKE - 16 batches Ã— 25 URLs
  # CHANGED: was 8 batches Ã— 50. These are deep combination URLs
  # (e.g. /listings/nsw-state/sydney-region/jayco/) that take ~26s each to fetch.
  # Old: 50 URLs Ã— 4 variants Ã— 26s = ~87 min â†’ TIMEOUT
  # New: 25 URLs Ã— 4 variants Ã— 26s = ~43 min â†’ safe within 90 min
  # ==========================================
  generate-region-make:
    runs-on: ubuntu-latest
    timeout-minutes: 90     # 25 URLs Ã— 4 variants Ã— ~26s = ~43 min, 90 is safe
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'large-types' || github.event.inputs.target == 'region-make'))

    strategy:
      matrix:
        batch: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
      fail-fast: false
      max-parallel: 16

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate region-make (Batch ${{ matrix.batch }}/16)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: region-make
          BATCH_SIZE: 25
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… region-make Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… region-make batch ${{ matrix.batch }} completed!"

  # ==========================================
  # CAT-REGION (~378 URLs) - 16 batches Ã— 25 URLs
  # CHANGED: was 8 batches Ã— 50. Same reasoning as region-make:
  # these are deep combination URLs that can be slow to fetch.
  # Old: 50 Ã— 4 Ã— ~26s = ~87 min â†’ TIMEOUT
  # New: 25 Ã— 4 Ã— ~26s = ~43 min â†’ safe within 90 min
  # ==========================================
  generate-cat-region:
    runs-on: ubuntu-latest
    timeout-minutes: 90     # 25 URLs Ã— 4 variants Ã— ~26s = ~43 min, 90 is safe
    if: |
      (github.event_name == 'schedule') ||
      (github.event_name == 'workflow_dispatch' &&
       (github.event.inputs.target == 'all' || github.event.inputs.target == 'large-types' || github.event.inputs.target == 'cat-region'))

    strategy:
      matrix:
        batch: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
      fail-fast: false
      max-parallel: 16

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ—ºï¸ Generate cat-region (Batch ${{ matrix.batch }}/16)
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: cat-region
          BATCH_SIZE: 25
          BATCH_NUMBER: ${{ matrix.batch }}
          SKIP_ROUTES_UPDATE: 'true'
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… cat-region Batch ${{ matrix.batch }} Complete
        if: success()
        run: echo "::notice::âœ… cat-region batch ${{ matrix.batch }} completed!"

  # ==========================================
  # UPDATE ROUTES MAPPING (After ALL jobs complete)
  # ==========================================
  update-routes-mapping:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs:
      - generate-priority
      - generate-small-types
      - generate-cat-state
      - generate-regions
      - generate-state-make
      - generate-makes
      - generate-models
      - generate-region-make
      - generate-cat-region
    if: |
      always() &&
      (github.event_name == 'schedule' ||
       github.event_name == 'workflow_dispatch')

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸ“‹ Regenerate Routes Mapping from KV
        env:
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
        run: node scripts/regenerate-routes-mapping.js

      - name: âœ… Routes Mapping Updated
        if: success()
        run: echo "::notice::âœ… Routes mapping regenerated successfully!"

  # ==========================================
  # INDIVIDUAL MANUAL RUNS (single type, no batching)
  # ==========================================
  generate-individual:
    runs-on: ubuntu-latest
    timeout-minutes: 120    # Single runner, no batching â€” needs generous timeout
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.target == 'categories' ||
       github.event.inputs.target == 'states'     ||
       github.event.inputs.target == 'regions'    ||
       github.event.inputs.target == 'price'      ||
       github.event.inputs.target == 'atm'        ||
       github.event.inputs.target == 'sleep'      ||
       github.event.inputs.target == 'length'     ||
       github.event.inputs.target == 'cat-state')

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install dependencies
        run: npm install node-fetch@2

      - name: ðŸŽ¯ Generate ${{ github.event.inputs.target }}
        env:
          PRODUCTION_DOMAIN: ${{ secrets.PRODUCTION_DOMAIN }}
          WP_API_BASE: 'https://admin.caravansforsale.com.au/wp-json/cfs/v1/sitemap'
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          TARGET_SITEMAP: ${{ github.event.inputs.target }}
        run: node scripts/generate-sitemap-cache-simple.js

      - name: âœ… Complete
        if: success()
        run: echo "::notice::âœ… ${{ github.event.inputs.target }} completed!"

  # ==========================================
  # SUMMARY
  # ==========================================
  summary:
    runs-on: ubuntu-latest
    needs:
      - generate-priority
      - generate-small-types
      - generate-cat-state
      - generate-regions
      - generate-state-make
      - generate-makes
      - generate-models
      - generate-region-make
      - generate-cat-region
      - update-routes-mapping
    if: always() && github.event_name == 'schedule'

    steps:
      - name: ðŸ“Š Summary
        run: |
          echo "::notice::âœ… All cache generation jobs completed!"
          echo "::notice::Source: WordPress API (no XML sitemaps)"
          echo "::notice::Priority: Homepage + Listings (4 variants each)"
          echo "::notice::Small types (6 in parallel): categories, states, price, atm, sleep, length"
          echo "::notice::Cat-state: own job (120-min timeout)"
          echo "::notice::Regions: 2 batches Ã— 50"
          echo "::notice::State-make: 2 batches Ã— 50"
          echo "::notice::Makes: 6 batches Ã— 50"
          echo "::notice::Models: 6 batches Ã— 50"
          echo "::notice::Region-make: 16 batches Ã— 25 (reduced from 8Ã—50 â€” slow pages)"
          echo "::notice::Cat-region: 16 batches Ã— 25 (reduced from 8Ã—50 â€” slow pages)"
          echo "::notice::Routes mapping: Regenerated after all jobs"
